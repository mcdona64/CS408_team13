cah.log={};cah.log.init=function(){cah.log.log=$('#tab-global .log');};cah.log.status=function(text,opt_class){cah.log.status_with_game(null,text,opt_class);};cah.log.status_with_game=function(game_or_id,text,opt_class,opt_allow_html){var logElement;if(game_or_id===null){logElement=cah.log.log;}else{var game;if(game_or_id instanceof cah.Game){game=game_or_id;}else{game=cah.currentGames[game_or_id];}
logElement=$(".log",game.getChatElement());}
var scroll=(logElement.prop("scrollHeight")- logElement.height()- logElement.prop("scrollTop"))<=5;var node=$("<span></span><br/>");var full_msg="["+ new Date().toLocaleTimeString()+"] "+ text+"\n";if(opt_allow_html){$(node[0]).html(full_msg);}else{$(node[0]).text(full_msg);}
if(opt_class){$(node).addClass(opt_class);}
logElement.append(node);if(game_or_id!==null||opt_class){cah.log.ariaStatus(text);}
if(scroll){logElement.prop("scrollTop",logElement.prop("scrollHeight"));}};cah.log.error=function(text){cah.log.everyWindow("Error: "+ text,"error");};cah.log.everyWindow=function(text,opt_class){cah.log.status(text,opt_class);for(game_id in cah.currentGames){if(cah.currentGames.hasOwnProperty(game_id)){cah.log.status_with_game(game_id,text,opt_class);}}};cah.log.ariaStatus=function(text){var chatMatch=text.match(/<([a-zA-Z0-9_]+)> (.*)/);if(chatMatch){$('#aria-notifications').text(chatMatch[1]+' says '+ chatMatch[2]);}else{$('#aria-notifications').text(text);}};cah.log.debug=function(text,opt_obj){if(cah.SILENT_DEBUG&&console){if(console.debug){console.debug("["+ new Date().toLocaleTimeString()+"]",text,opt_obj);}else if(console.log){console.log("["+ new Date().toLocaleTimeString()+"] "+ text);if(opt_obj){if(console.dir){console.dir(opt_obj);}else if(JSON&&JSON.stringify){console.log(JSON.stringify(opt_obj));}else{console.log("TODO: SILENT_DEBUG without console.debug, with console.log, "
+"without console.dir, without JSON.stringify");}}}else if(console.log){console.log("["+ new Date().toLocaleTimeString()+"]",text,opt_obj);}}
if(cah.DEBUG){if(opt_obj){if(JSON&&JSON.stringify){cah.log.debug(text+": "+ JSON.stringify(opt_obj));}else{cah.log.debug(text+": TODO: debug log without JSON.stringify()");}}else{cah.log.status("DEBUG: "+ text,"debug");}}};